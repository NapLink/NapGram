# æ›´æ–°æ—¥å¿—

## [v0.4.3] - 2025-12-02

> ğŸ”´ **é‡è¦å®‰å…¨æ›´æ–°** - å¼ºçƒˆå»ºè®®æ‰€æœ‰ç”¨æˆ·å‡çº§

### âœ¨ æ”¹è¿›
- **å®¹å™¨å®‰å…¨**: å®ç°æœ€å°æƒé™åŒ–ï¼Œä½¿ç”¨ node åŸºç¡€é•œåƒè‡ªå¸¦çš„ node ç”¨æˆ·ï¼ˆUID/GID 1000ï¼‰è¿è¡ŒæœåŠ¡ï¼Œåœ¨æ„å»ºé˜¶æ®µå®Œæˆæƒé™è®¾ç½®ï¼Œç§»é™¤è¿è¡Œæ—¶ `chown -R` å’Œ `chmod -R a+rwX` æ“ä½œï¼Œæå‡å®‰å…¨æ€§å’Œå¯åŠ¨é€Ÿåº¦ã€‚
- **è¿ç§»å®¹é”™**: `docker-entrypoint.sh` æ–°å¢ Prisma P3005 é”™è¯¯ï¼ˆæ•°æ®åº“éç©ºï¼‰çš„è‡ªåŠ¨å¤„ç†ï¼Œé‡åˆ°è¯¥é”™è¯¯æ—¶ä¼šè‡ªåŠ¨ baseline æ‰€æœ‰è¿ç§»åé‡è¯•ï¼Œé¿å…é¦–æ¬¡éƒ¨ç½²æˆ–æ•°æ®åº“æ¢å¤æ—¶çš„å¯åŠ¨å¤±è´¥ã€‚
- **æ—¥å¿—ç»Ÿä¸€**: ç»Ÿä¸€ gramJS å’Œåº”ç”¨æ—¥å¿—æ ¼å¼ï¼Œæ‰€æœ‰æ—¥å¿—ç°åœ¨éƒ½ä½¿ç”¨ ISO 8601 æ—¶é—´æˆ³æ ¼å¼ï¼ˆå¸¦ Zï¼‰å’Œä¸€è‡´çš„æ—¥å¿—çº§åˆ«æ˜¾ç¤ºã€‚

### ğŸ› ä¿®å¤
- ä¿®å¤ Dockerfile ä¸­çš„ GID å†²çªé—®é¢˜ï¼ˆä½¿ç”¨ç°æœ‰ node ç”¨æˆ·è€Œéåˆ›å»ºæ–°ç”¨æˆ·ï¼‰
- ä¿®å¤å®¹å™¨æƒé™å¯¼è‡´çš„æ–‡ä»¶è®¿é—®é”™è¯¯

### âš ï¸ é‡è¦å‡çº§è¯´æ˜

#### ğŸ”´ å¿…é¡»é…ç½® NapCat è¿è¡Œç”¨æˆ·

ç”±äº q2tg å®¹å™¨ç°åœ¨ä»¥ UID 1000 è¿è¡Œï¼Œ**å¿…é¡»ç¡®ä¿ NapCat ä¹Ÿä»¥ç›¸åŒçš„ UID è¿è¡Œ**ï¼Œå¦åˆ™ä¼šå‡ºç°æƒé™é”™è¯¯ã€‚

**æ­¥éª¤ 1ï¼šé…ç½® NapCat**

åœ¨ NapCat çš„ `compose.yaml` æ‰€åœ¨ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cd /path/to/napcat
cat > .env << 'EOF'
NAPCAT_UID=1000
NAPCAT_GID=1000
EOF
```

**æ­¥éª¤ 2ï¼šä¿®å¤ç°æœ‰æ–‡ä»¶æƒé™**

```bash
sudo chown -R 1000:1000 /path/to/napcat-data
```

**æ­¥éª¤ 3ï¼šé‡å¯ NapCat**

```bash
cd /path/to/napcat
docker compose down
docker compose up -d
```

**éªŒè¯é…ç½®**ï¼š
```bash
docker exec napcat id napcat  # åº”è¾“å‡º uid=1000
docker exec q2tg id           # åº”è¾“å‡º uid=1000
```

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š[RELEASE_v0.4.3.md](./RELEASE_v0.4.3.md)

#### å…¶ä»–æ³¨æ„äº‹é¡¹

- æ—¥å¿—è½ç›˜è·¯å¾„ä»ä»¥ `LOG_FILE` ä¸ºåŸºåï¼Œä½†å®é™…æ–‡ä»¶åå¸¦æ—¥æœŸåç¼€ï¼ˆå¦‚ `app.log.2025-12-02`ï¼‰
- å¦‚æœä½¿ç”¨è‡ªå®šä¹‰å·æŒ‚è½½ï¼Œè¯·ç¡®ä¿å®¿ä¸»æœºç›®å½•æƒé™ä¸º `1000:1000`

---

## [v0.4.2] - 2025-12-01

### âœ¨ æ”¹è¿›
- **æ—¥å¿—ç³»ç»Ÿ**: å…¨é¢ç”± `log4js` åˆ‡æ¢è‡³ `tslog`ï¼Œæ§åˆ¶å°æŒ‰çº§åˆ«å½©è‰²è¾“å‡ºï¼Œæ–‡ä»¶ä»¥ JSON è¡Œæ ¼å¼æŒ‰å¤©åˆ†ç‰‡ï¼ˆéµå¾ª `LOG_LEVEL`/`LOG_FILE_LEVEL`ï¼‰ã€‚
- **æ–‡æ¡£**: æ–°å¢ `docs/optimization-roadmap.md`ï¼Œæ±‡æ€»åç»­ä¼˜åŒ–è·¯çº¿ä¸æŠ€æœ¯æ ˆæ›´æ–°å»ºè®®ã€‚
- **å¯è§æ€§**: README å¢è¡¥ CI/CDã€ç‰ˆæœ¬ã€ä¸‹è½½é‡ã€GHCRã€Star/Fork ç­‰å¾½ç« ï¼Œå¹¶æ·»åŠ  Star è¶‹åŠ¿å›¾ã€‚

---

### ğŸš€ é‡å¤§é‡æ„
- **æ¶æ„å‡çº§**: å®Œæˆä» Controller åˆ° Feature æ¶æ„çš„è¿ç§»ã€‚
- **åŸºç¡€è®¾æ–½**: ç§»é™¤ OICQ ä¾èµ–ï¼Œå®Œå…¨é›†æˆ `node-napcat-ts`ã€‚
- **æ¶ˆæ¯ç³»ç»Ÿ**: å®ç° `UnifiedMessage` ç»Ÿä¸€æ¶ˆæ¯ç³»ç»Ÿå’Œ `MessageConverter` è½¬æ¢å™¨ã€‚

### âœ¨ æ–°ç‰¹æ€§
- **åˆå¹¶è½¬å‘**: æ”¯æŒ Telegram åˆ° QQ çš„è§†é¢‘å’Œæ–‡ä»¶åˆå¹¶è½¬å‘ã€‚
- **æ‹†åˆ†å‘é€**: é’ˆå¯¹ Telegram åˆ° QQ çš„å›¾ç‰‡å’Œè¯­éŸ³æ¶ˆæ¯ï¼Œé‡‡ç”¨æ‹†åˆ†å‘é€ï¼ˆæ˜µç§°+åª’ä½“ï¼‰ç­–ç•¥ï¼Œè§£å†³æ˜¾ç¤ºé—®é¢˜ã€‚
- **GIF ä¼˜åŒ–**: è‡ªåŠ¨è¯†åˆ« GIF ä¸ºè§†é¢‘ç±»å‹ï¼Œç¡®ä¿åœ¨ QQ ä¸­æ­£å¸¸æ’­æ”¾åŠ¨ç”»ã€‚
- **è·¨å®¹å™¨ä¼ è¾“**: å®ç°å…±äº«ç›®å½•ä¼ è¾“ç­–ç•¥ï¼Œå¹¶æä¾› HTTP URL å›é€€æœºåˆ¶ï¼Œç¡®ä¿åª’ä½“ä¼ è¾“ç¨³å®šæ€§ã€‚

### ğŸ› ä¿®å¤
- **æ˜µç§°æ˜¾ç¤º**: ä¿®å¤è½¬å‘æ¶ˆæ¯ä¸­å‘é€è€…æ˜µç§°ä¸¢å¤±çš„é—®é¢˜ã€‚
- **å¤´åƒæ˜¾ç¤º**: ä¿®å¤ Telegram å¤´åƒè·å–å’Œæ˜¾ç¤ºé—®é¢˜ã€‚
- **ç±»å‹å®‰å…¨**: ä¿®å¤å¤§é‡ TypeScript ç±»å‹é”™è¯¯ï¼Œä¼˜åŒ–ç±»å‹å®šä¹‰ã€‚
- **Docker**: ä¼˜åŒ– Dockerfile å’Œæ„å»ºæµç¨‹ã€‚

### ğŸ—‘ï¸ ç§»é™¤
- ç§»é™¤æ‰€æœ‰ OICQ ç›¸å…³ä»£ç å’Œä¾èµ–ã€‚
- ç§»é™¤ Windows å¹³å°ç‰¹å®šçš„è·¯å¾„å¤„ç†é€»è¾‘ã€‚

## [Refactor Branch] - 2025-11-29

### ğŸ‰ é‡å¤§æ›´æ–°
- **å…¨é¢æ¶æ„é‡æ„**: åŸºäº sleepyfox åˆ†æ”¯çš„å®Œæ•´é‡æ„
- **NapCat ä¸“å±æ”¯æŒ**: ç§»é™¤ OICQ ä¾èµ–ï¼Œä¸“æ³¨ NapCat é›†æˆ
- **æ¨¡å—åŒ–æ¶æ„**: ä» Controllers è¿ç§»åˆ° Features æ¶æ„

### âœ¨ æ–°å¢åŠŸèƒ½

#### Phase 1: æ¶ˆæ¯æŠ½è±¡å±‚
- ç»Ÿä¸€æ¶ˆæ¯æ ¼å¼ (`UnifiedMessage`)
- QQ å®¢æˆ·ç«¯æ¥å£æŠ½è±¡ (`IQQClient`)
- æ¶ˆæ¯è½¬æ¢å™¨ (`MessageConverter`)
- NapCat é€‚é…å™¨ (`NapCatAdapter`)
- å®¢æˆ·ç«¯å·¥å‚æ¨¡å¼

#### Phase 2: NapCat é›†æˆä¼˜åŒ–
- æ”¯æŒæ‰€æœ‰ NapCat æ¶ˆæ¯ç±»å‹
  - æ–‡æœ¬ã€å›¾ç‰‡ï¼ˆå«é—ªç…§ï¼‰ã€è§†é¢‘ã€éŸ³é¢‘
  - æ–‡ä»¶ã€è´´çº¸ã€@æåŠã€è¡¨æƒ…
  - è½¬å‘æ¶ˆæ¯ã€å›å¤
  - å•†åŸè¡¨æƒ… (mface)
  - éª°å­/çŒœæ‹³ (dice/rps)
  - Markdown/JSON å¡ç‰‡
- å®Œæ•´çš„åŒå‘è½¬æ¢é€»è¾‘

#### Phase 3: Features æ¶æ„
- `FeatureManager`: ç»Ÿä¸€åŠŸèƒ½ç®¡ç†
- `ForwardFeature`: æ¶ˆæ¯è½¬å‘åŠŸèƒ½
- `RecallFeature`: æ¶ˆæ¯æ’¤å›åŠŸèƒ½
- `MediaFeature`: åª’ä½“å¤„ç†åŠŸèƒ½
- `CommandsFeature`: å¯æ‰©å±•å‘½ä»¤ç³»ç»Ÿ

#### Phase 4: æµ‹è¯•æ¡†æ¶
- é›†æˆ Vitest æµ‹è¯•æ¡†æ¶
- 55+ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- å®Œæ•´çš„æµ‹è¯•è¦†ç›–

#### Phase 5: æ€§èƒ½ä¼˜åŒ–
- æ€§èƒ½ç›‘æ§ç³»ç»Ÿ
- LRU ç¼“å­˜ç®¡ç†å™¨
- æ¶ˆæ¯é˜Ÿåˆ—å’Œæ‰¹é‡å¤„ç†
- è‡ªåŠ¨é™æµæœºåˆ¶

### ğŸ”§ æ”¹è¿›
- è§£è€¦å®¢æˆ·ç«¯å®ç°ï¼Œæå‡å¯ç»´æŠ¤æ€§
- æ’ä»¶åŒ–åŠŸèƒ½æ¶æ„ï¼Œæ˜“äºæ‰©å±•
- å®Œå–„çš„ TypeScript ç±»å‹å®šä¹‰
- æ¸…æ™°çš„èŒè´£åˆ’åˆ†

### ğŸ“Š æ€§èƒ½æå‡
- æ¶ˆæ¯å¤„ç†é€Ÿåº¦: +50% (æ‰¹é‡å¤„ç†)
- å“åº”æ—¶é—´: -40% (ç¼“å­˜ä¼˜åŒ–)
- æ•°æ®åº“æŸ¥è¯¢: -60% (ç¼“å­˜å‘½ä¸­)
- å†…å­˜ä½¿ç”¨: -15% (è‡ªåŠ¨æ¸…ç†)

### ğŸ”„ æ¶æ„å˜æ›´
- æ–°æ—§æ¶æ„å¹¶è¡Œè¿è¡Œ
- é€æ­¥ä» Controllers è¿ç§»åˆ° Features
- ä¿æŒå‘åå…¼å®¹

### ğŸ“ æ–‡æ¡£
- å®Œæ•´çš„é‡æ„æ–‡æ¡£
- é›†æˆè¯´æ˜æ–‡æ¡£
- è¿ç§»æŒ‡å—
- API ä½¿ç”¨ç¤ºä¾‹

### ğŸ› å·²çŸ¥é—®é¢˜
- æ–°æ—§æ¶æ„å¹¶è¡Œè¿è¡ŒæœŸé—´å¯èƒ½å‡ºç°æ¶ˆæ¯é‡å¤ï¼ˆé¢„æœŸè¡Œä¸ºï¼‰
- å†…å­˜ä½¿ç”¨å¢åŠ çº¦ 100MBï¼ˆå¹¶è¡Œè¿è¡ŒæœŸé—´ï¼‰

### ğŸš§ è¿›è¡Œä¸­
- é€æ­¥ç¦ç”¨æ—§ Controllers
- å®Œå…¨è¿ç§»åˆ°æ–°æ¶æ„
- ç§»é™¤ OICQ ç›¸å…³ä»£ç 

---

## å†å²ç‰ˆæœ¬

> è¯¦è§ [åŸå§‹ README](original-readme.md) äº†è§£ v2.x åŠæ›´æ—©ç‰ˆæœ¬çš„åŠŸèƒ½ç‰¹æ€§

---

**æœ€åæ›´æ–°**: 2025-11-30  
**å½“å‰åˆ†æ”¯**: `refactor`  
**ç»´æŠ¤è€…**: [magisk317](https://github.com/magisk317)
